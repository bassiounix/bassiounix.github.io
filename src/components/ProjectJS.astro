<project-js>
  <slot />
</project-js>

<script>
  class ProjectJS extends HTMLElement {
    connectedCallback() {
      this.querySelectorAll(".envelope-back").forEach((envelope) => {
        const repoLinkElement = envelope.querySelector(".envelope-title");

        if (repoLinkElement) {
          const repoUrl = repoLinkElement.getAttribute("href");

          if (repoUrl) {
            const urlParts = repoUrl.split("/");
            const owner = urlParts[urlParts.length - 2];
            const repo = urlParts[urlParts.length - 1];

            fetch(`https://api.github.com/repos/${owner}/${repo}`)
              .then((res) => res.json())
              .then((data) => {
                const repoUserSpan = envelope.querySelector(".repo-user span");
                const repoForkSpan = envelope.querySelector(".repo-fork span");
                const repoStarSpan = envelope.querySelector(".repo-star span");
                const repoWatchSpan =
                  envelope.querySelector(".repo-watch span");

                if (repoUserSpan) repoUserSpan.textContent = data.owner.login;
                if (repoForkSpan) repoForkSpan.textContent = data.forks_count;
                if (repoStarSpan)
                  repoStarSpan.textContent = data.stargazers_count;
                if (repoWatchSpan)
                  repoWatchSpan.textContent = data.subscribers_count;
              })
              .catch((error) => {
                console.error("Error fetching repository data:", error);
              });
          }
        }
      });
    }
  }

  customElements.define("project-js", ProjectJS);
</script>
